<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Syntax Reference · CompileBot.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">CompileBot.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Syntax Reference</a><ul class="internal"><li><a class="tocitem" href="#Snoop-bot-1"><span>Snoop bot</span></a></li><li><a class="tocitem" href="#Snoop-bot-utilities-1"><span>Snoop bot utilities</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Syntax Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Syntax Reference</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/aminya/CompileBot.jl/blob/master/docs/src/reference.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Reference-1"><a class="docs-heading-anchor" href="#Reference-1">Reference</a><a class="docs-heading-anchor-permalink" href="#Reference-1" title="Permalink"></a></h1><h2 id="Snoop-bot-1"><a class="docs-heading-anchor" href="#Snoop-bot-1">Snoop bot</a><a class="docs-heading-anchor-permalink" href="#Snoop-bot-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="CompileBot.BotConfig" href="#CompileBot.BotConfig"><code>CompileBot.BotConfig</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">BotConfig(package_name::AbstractString ; exclusions, os, else_os, version, else_version, package_path, precompiles_rootpath, subst, tmin)</code></pre><p>Construct a SnoopCompile bot configuration. <code>package_name</code> is the name of the package. This object is passed to <a href="#CompileBot.snoop_bot"><code>snoop_bot</code></a> and <a href="#CompileBot.snoop_bench"><code>snoop_bench</code></a>.</p><p>You may supply the following optional <strong>keyword</strong> arguments:</p><ul><li><p><code>exclusions</code> : A vector of of Strings (or RegExp) to exclude some functions from being precompiled</p></li><li><p><code>os</code>: A vector of of Strings (or RegExp) to support with precompile statements.</p></li></ul><p>Example: <code>os = [&quot;windows&quot;, &quot;linux&quot;]</code></p><ul><li><code>else_os</code>: If you want to use a specific operating system&#39;s precompile file as the default, set <code>else_os</code> to the name of that os. Not passing this argument skips precompilation on any operating system other than those explicitly listed in <code>os</code>.</li></ul><p>Example: <code>else_os = &quot;linux&quot;</code></p><ul><li><code>version</code>: A vector of of Julia versions used to generate precompile signatures.</li></ul><p>Example: <code>version = [v&quot;1.1&quot;,v&quot;1.5.0&quot;, &quot;nightly&quot;]</code></p><p>It is assumed that the generated precompile signatures are valid for patch versions of Julia (e.g. givingv&quot;1.5.0&quot; supports v&quot;1.4.0&quot; to v&quot;1.4.999&quot;).</p><ul><li><code>else_version</code>: the Julia version used to generate the default signatures for other <code>version</code>s.</li></ul><p>Not passing this argument skips precompilation on any Julia version other than those explicitly listed in <code>version</code>.</p><p>Example: <code>else_version =v&quot;1.5.0&quot;</code></p><ul><li><code>yml_path</code>: instead of directly passing <code>os</code> and <code>version</code> to BotConfig, you can pass <code>yml_path</code> which should be the GitHub actions YAML path or file name.</li></ul><p>It assumes that the job name is <code>SnoopCompile</code>.</p><p>Example: <code>yaml_path = &quot;SnoopCompile.yml&quot;</code></p><ul><li><p><code>package_path</code>: path to the main <code>.jl</code> file of the package (similar to <code>pathof</code>). Default path is <code>pathof_noload(package_name)</code>.</p></li><li><p><code>precompiles_rootpath</code>: the path where precompile files are stored. Default path is &quot;dirname(dirname(package_path))/deps/SnoopCompile/precompile&quot;.</p></li><li><p><code>subst</code> : A vector of pairs of Strings (or RegExp) to replace a packages precompile statements with another&#39;s package like <code>[&quot;ImageTest&quot; =&gt; &quot;Images&quot;]</code>.</p></li><li><p><code>tmin</code>: Methods that take less time than <code>tmin</code> to be inferred will not be added to the precompile statements. Defaults to 0.01. Set it to 0.0 if you want to include all the sentences.</p></li><li><p><code>check_eval</code>: By default, the bot discards the precompile statements that cannot be <code>eval</code>ed.</p></li></ul><p>In rare cases (when snooping is very time consuming), you may want to do this manually by using the printed errors to add the problematic functions to <code>exclusions</code> and then set <code>check_eval=false</code> for the future runs.</p><p><strong>Example</strong></p><pre><code class="language-julia">botconfig1 = BotConfig(
  &quot;Zygote&quot;;                            # package name (the one this configuration lives in)
  os = [&quot;linux&quot;, &quot;windows&quot;, &quot;macos&quot;],  # operating systems for which to precompile
  version = [v&quot;1.5.0&quot;, v&quot;1.3.1&quot;],      # supported Julia versions
  exclusions = [&quot;SqEuclidean&quot;],         # exclude functions (by name) that would be problematic if precompiled
)

botconfig2 = BotConfig(
  &quot;Zygote&quot;;                            # package name (the one this configuration lives in)
  yml_path = &quot;SnoopCompile.yml&quot;        # parse `os` and `version` from `SnoopCompile.yml`
  exclusions = [&quot;SqEuclidean&quot;],         # exclude functions (by name) that would be problematic if precompiled
)

# A full example:
BotConfig(&quot;MatLang&quot;, exclusions = [&quot;badfunction&quot;], os = [&quot;linux&quot;, &quot;windows&quot;, &quot;macos&quot;], else_os = &quot;linux&quot;, version = [&quot;1.5.0&quot;, &quot;1.2&quot;, &quot;1.0.5&quot;], else_version = &quot;1.5.0&quot; )

# Different examples for other possibilities:
BotConfig(&quot;MatLang&quot;)

BotConfig(&quot;MatLang&quot;, exclusions = [&quot;badfunction&quot;])

BotConfig(&quot;MatLang&quot;, os = [&quot;linux&quot;, &quot;windows&quot;])

BotConfig(&quot;MatLang&quot;, os = [&quot;windows&quot;, &quot;linux&quot;], else_os = &quot;linux&quot;)

BotConfig(&quot;MatLang&quot;, version = [v&quot;1.1&quot;,v&quot;1.5.0&quot;])

BotConfig(&quot;MatLang&quot;, version = [v&quot;1.1&quot;,v&quot;1.5.0&quot;], else_version =v&quot;1.5.0&quot;)

BotConfig(&quot;MatLang&quot;, os = [&quot;linux&quot;, &quot;windows&quot;], version = [v&quot;1.1&quot;,v&quot;1.5.0&quot;])</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aminya/CompileBot.jl/blob/0f8637a9afc69e3013b615c83a060e84cf7025ee/src/CompileBot.jl#LL22-L109">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CompileBot.snoop_bot" href="#CompileBot.snoop_bot"><code>CompileBot.snoop_bot</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">snoop_bot(config::BotConfig, path_to_example_script::String, test_modul=Main; snoop_mode=:auto)</code></pre><p>Generate precompile statements using a precompile script. <code>config</code> can be generated by <a href="#CompileBot.BotConfig"><code>BotConfig</code></a>. <code>path_to_example_script</code> is preferred to be an absolute path. The example script will be run in the module specified by <code>test_modul</code>. <code>snoop_mode</code> can be <code>:auto</code>, <code>:snoopi</code> (to run <a href="@ref"><code>SnoopCompileCore.@snoopi</code></a>), or <code>:snoopc</code> (to run <a href="@ref"><code>SnoopCompileCore.@snoopc</code></a>), where <code>:auto</code> chooses <code>:snoopi</code> on supported versions of Julia.</p><p>See the <a href="https://timholy.github.io/SnoopCompile.jl/stable/bot/">online documentation</a> for a more complete overview.</p><p><strong>Extended help</strong></p><p><strong>Example</strong></p><p>In this case, the bot-running script is placed in the same directory as the precompile script, so we can use <code>@__DIR__</code> to find it:</p><pre><code class="language-julia">using CompileBot

snoop_bot(BotConfig(&quot;MatLang&quot;), &quot;$(@__DIR__)/example_script.jl&quot;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aminya/CompileBot.jl/blob/0f8637a9afc69e3013b615c83a060e84cf7025ee/src/snoop_bot.jl#LL166-L192">source</a></section><section><div><pre><code class="language-none">snoop_bot(config::BotConfig, test_modul::Module = Main; snoop_mode::Symbol = :auto)</code></pre><p>Generate precompile statements using the package&#39;s <code>runtests.jl</code> file.</p><p>During snooping, <code>snoop_bot</code> sets the global variable <code>SnoopCompile_ENV</code> to <code>true</code>. If needed, your <code>runtests.jl</code> can check for the existence and value of this variable to customize test behavior specifically for snooping.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aminya/CompileBot.jl/blob/0f8637a9afc69e3013b615c83a060e84cf7025ee/src/snoop_bot.jl#LL204-L212">source</a></section><section><div><pre><code class="language-none">snoop_bot(config::BotConfig, expression::Expr, test_modul::Module = Main; snoop_mode::Symbol = :auto)</code></pre><p>Generate precompile statements by evaluating an expression, for example <code>:(using MyPackage)</code>. Interpolation and macros are not supported.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aminya/CompileBot.jl/blob/0f8637a9afc69e3013b615c83a060e84cf7025ee/src/snoop_bot.jl#LL220-L225">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CompileBot.snoop_bench" href="#CompileBot.snoop_bench"><code>CompileBot.snoop_bench</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">snoop_bench(config::BotConfig, path_to_example_script::String, test_modul::Module=Main; snoop_mode=:auto)</code></pre><p>Benchmark the impact of precompile statements, by running a script with and without the precompiles. <code>config</code> can be generated by <a href="#CompileBot.BotConfig"><code>BotConfig</code></a>. <code>path_to_example_script</code> is preferred to be an absolute path. The example script will be run in the module specified by <code>test_modul</code>. <code>snoop_mode</code> can be <code>:auto</code>, <code>:snoopi</code> (to test with <a href="@ref"><code>SnoopCompileCore.@snoopi</code></a>), or <code>:runtime</code> (to measure total script run time with <code>@timev</code>). <code>:auto</code> chooses <code>:snoopi</code> on supported versions of Julia.</p><p>See the <a href="https://timholy.github.io/SnoopCompile.jl/stable/bot/">online documentation</a> for a more complete overview.</p><p><strong>Extended help</strong></p><p><strong>Example</strong></p><p>In this case, the benchmarking script is placed in the same directory as the precompile script, so we can use <code>@__DIR__</code> to find it:</p><pre><code class="language-julia">using CompileBot

snoop_bench(BotConfig(&quot;MatLang&quot;), &quot;$(@__DIR__)/example_script.jl&quot;)</code></pre><p>As an alternative to <code>@__DIR__</code> (for example, if you store your benchmarking script(s) outside the package itself), you can find the package with <a href="#CompileBot.pathof_noload"><code>pathof_noload</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aminya/CompileBot.jl/blob/0f8637a9afc69e3013b615c83a060e84cf7025ee/src/snoop_bench.jl#LL112-L141">source</a></section><section><div><pre><code class="language-none">snoop_bench(config::BotConfig, test_modul::Module = Main; snoop_mode::Symbol = :auto)</code></pre><p>Benchmark your precompile files using the package&#39;s <code>runtests.jl</code> file.</p><p>During snooping, <code>snoop_bench</code> sets the global variable <code>SnoopCompile_ENV</code> to <code>true</code>. If needed, your <code>runtests.jl</code> can check for the existence and value of this variable to customize test behavior specifically for snooping. ```</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aminya/CompileBot.jl/blob/0f8637a9afc69e3013b615c83a060e84cf7025ee/src/snoop_bench.jl#LL152-L161">source</a></section><section><div><pre><code class="language-none">snoop_bench(config::BotConfig, expression::Expr, test_modul::Module = Main; snoop_mode::Symbol = :auto)</code></pre><p>Benchmark your precompile files by evaluating an expression, for example <code>:(using MyPackage)</code>. Interpolation and macros are not supported.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aminya/CompileBot.jl/blob/0f8637a9afc69e3013b615c83a060e84cf7025ee/src/snoop_bench.jl#LL167-L172">source</a></section></article><h2 id="Snoop-bot-utilities-1"><a class="docs-heading-anchor" href="#Snoop-bot-utilities-1">Snoop bot utilities</a><a class="docs-heading-anchor-permalink" href="#Snoop-bot-utilities-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="CompileBot.pathof_noload" href="#CompileBot.pathof_noload"><code>CompileBot.pathof_noload</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Returns a package&#39;s path without loading the package in the main Julia process. May launch a separate Julia process to find the package.</p><p><strong>Examples</strong></p><pre><code class="language-julia">pathof_noload(&quot;MatLang&quot;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aminya/CompileBot.jl/blob/0f8637a9afc69e3013b615c83a060e84cf7025ee/src/botutils.jl#LL209-L217">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CompileBot.timesum" href="#CompileBot.timesum"><code>CompileBot.timesum</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">timesum(snoop::Vector{Tuple{Float64, Core.MethodInstance}}, unit = :s)</code></pre><p>Calculates the total time measured by a snoop macro. <code>unit</code> can be :s or :ms.</p><p><strong>Examples</strong></p><pre><code class="language-julia">using SnoopCompile
data = @snoopi begin
    using MatLang
    MatLang_rootpath = dirname(dirname(pathof(&quot;MatLang&quot;)))

    include(&quot;$MatLang_rootpath/test/runtests.jl&quot;)
end
println(timesum(data, :ms))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aminya/CompileBot.jl/blob/0f8637a9afc69e3013b615c83a060e84cf7025ee/src/botutils.jl#LL3-L19">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 7 February 2023 18:10">Tuesday 7 February 2023</span>. Using Julia version 1.10.0-DEV.524.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
